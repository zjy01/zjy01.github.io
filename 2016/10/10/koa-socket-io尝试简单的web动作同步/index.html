<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            koa+socket.io尝试简单的web动作同步 | 
        
        zjyBlog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/public/img/favicon.png">
    <link rel="icon" href="/public/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="动作同步尝试用过browser-sync辅助开发的前端同学，大概都会感到神奇：在多个端打开网页，网页的动作却是完全同步的。当然我还没有看过源码，大概也知道是通过’websocket’实现信息同步。今天在看书籍《跨终端Web》–徐凯 的时候，里面有一部分 web动作同步的代码演示。于是做了demo做练习。
准备工具
koa : @1.1.2socket.io : @1.5.0

其中koa并没有什么特别意思，只是作为一个服务器存在，用express或者其他什么都可以。socket.io是我们需要的通讯库
原理1、 前端捕获正在发生的动作action，和触发动作的元素target，通过客户端socket传输到服务器socket;2、 服务器socket接收到信息，再将信息广播到其他所有客户端socket;3、 其他客户端socket接收到广播信息，使特定的元素target触发特定的动作action">
    <meta name="keywords" content=",nodejs,socket,前端">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/vibrant-ink.min.css?e5E/qqGcGveS7VTH4M896w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","https://cdn.bootcss.com/jquery/2.2.1/jquery.js", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="zjyBlog">
    <meta name="msapplication-starturl" content="/2016/10/10/koa-socket-io尝试简单的web动作同步/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="zjyBlog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/public/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="/2016/10/10/koa-socket-io尝试简单的web动作同步/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="koa+socket.io尝试简单的web动作同步 | zjyBlog">
    <meta property="og:image" content="/public/img/favicon.png">
    <meta property="og:description" content="动作同步尝试用过browser-sync辅助开发的前端同学，大概都会感到神奇：在多个端打开网页，网页的动作却是完全同步的。当然我还没有看过源码，大概也知道是通过’websocket’实现信息同步。今天在看书籍《跨终端Web》–徐凯 的时候，里面有一部分 web动作同步的代码演示。于是做了demo做练习。
准备工具
koa : @1.1.2socket.io : @1.5.0

其中koa并没有什么特别意思，只是作为一个服务器存在，用express或者其他什么都可以。socket.io是我们需要的通讯库
原理1、 前端捕获正在发生的动作action，和触发动作的元素target，通过客户端socket传输到服务器socket;2、 服务器socket接收到信息，再将信息广播到其他所有客户端socket;3、 其他客户端socket接收到广播信息，使特定的元素target触发特定的动作action">
    <meta property="og:article:tag" content="nodejs"> <meta property="og:article:tag" content="socket"> <meta property="og:article:tag" content="前端"> 

    
        <meta property="article:published_time" content="Mon Oct 10 2016 15:13:18 GMT+0800">
        <meta property="article:modified_time" content="Thu Feb 01 2018 15:13:57 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="/2016/10/10/koa-socket-io尝试简单的web动作同步/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "/2016/10/10/koa-socket-io尝试简单的web动作同步/index.html",
    "headline": "koa+socket.io尝试简单的web动作同步",
    "datePublished": "Mon Oct 10 2016 15:13:18 GMT+0800",
    "dateModified": "Thu Feb 01 2018 15:13:57 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "carvenzhang",
        "image": {
            "@type": "ImageObject",
            "url": "/public/img/avatar.png"
        },
        "description": "From nothing to nothing"
    },
    "publisher": {
        "@type": "Organization",
        "name": "zjyBlog",
        "logo": {
            "@type":"ImageObject",
            "url": "/public/img/favicon.png"
        }
    },
    "keywords": ",nodejs,socket,前端",
    "description": "动作同步尝试用过browser-sync辅助开发的前端同学，大概都会感到神奇：在多个端打开网页，网页的动作却是完全同步的。当然我还没有看过源码，大概也知道是通过’websocket’实现信息同步。今天在看书籍《跨终端Web》–徐凯 的时候，里面有一部分 web动作同步的代码演示。于是做了demo做练习。
准备工具
koa : @1.1.2socket.io : @1.5.0

其中koa并没有什么特别意思，只是作为一个服务器存在，用express或者其他什么都可以。socket.io是我们需要的通讯库
原理1、 前端捕获正在发生的动作action，和触发动作的元素target，通过客户端socket传输到服务器socket;2、 服务器socket接收到信息，再将信息广播到其他所有客户端socket;3、 其他客户端socket接收到广播信息，使特定的元素target触发特定的动作action",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#动作同步"><span class="post-toc-number">1.</span> <span class="post-toc-text">动作同步</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#准备工具"><span class="post-toc-number">2.</span> <span class="post-toc-text">准备工具</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#原理"><span class="post-toc-number">3.</span> <span class="post-toc-text">原理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#服务端准备"><span class="post-toc-number">4.</span> <span class="post-toc-text">服务端准备</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#客户端的准备"><span class="post-toc-number">5.</span> <span class="post-toc-text">客户端的准备</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、-准确捕获发生的动作和目标元素"><span class="post-toc-number">5.0.1.</span> <span class="post-toc-text">1、 准确捕获发生的动作和目标元素</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、-通过socket发送正在发生的动作和目标元素"><span class="post-toc-number">5.0.2.</span> <span class="post-toc-text">2、 通过socket发送正在发生的动作和目标元素</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、-接受socket，并使目标元素促发目标动作。"><span class="post-toc-number">5.0.3.</span> <span class="post-toc-text">3、 接受socket，并使目标元素促发目标动作。</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#效果图"><span class="post-toc-number">6.</span> <span class="post-toc-text">效果图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结尾"><span class="post-toc-number">7.</span> <span class="post-toc-text">结尾</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                koa+socket.io尝试简单的web动作同步
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/public/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>carvenzhang</strong>
        <span>10月 10, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="https://pan.baidu.com/share/qrcode?w=246&h=246&url=/2016/10/10/koa-socket-io尝试简单的web动作同步/">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/nodejs/">nodejs</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/socket/">socket</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/前端/">前端</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=koa+socket.io尝试简单的web动作同步&url=/2016/10/10/koa-socket-io尝试简单的web动作同步/index.html&pic=/public/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=koa+socket.io尝试简单的web动作同步&url=/2016/10/10/koa-socket-io尝试简单的web动作同步/index.html&via=carvenzhang" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=/2016/10/10/koa-socket-io尝试简单的web动作同步/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=/2016/10/10/koa-socket-io尝试简单的web动作同步/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="动作同步"><a href="#动作同步" class="headerlink" title="动作同步"></a>动作同步</h2><p>尝试用过<code>browser-sync</code>辅助开发的前端同学，大概都会感到神奇：<strong>在多个端打开网页，网页的动作却是完全同步的</strong>。<br><img src="http://www.browsersync.cn/img/scroll-demo.gif" alt=""><br>当然我还没有看过源码，大概也知道是通过’websocket’实现信息同步。<br>今天在看书籍《跨终端Web》–<em>徐凯</em> 的时候，里面有一部分 <code>web动作同步</code>的代码演示。于是做了demo做练习。</p>
<h2 id="准备工具"><a href="#准备工具" class="headerlink" title="准备工具"></a>准备工具</h2><blockquote>
<p>koa : @1.1.2<br>socket.io : @1.5.0</p>
</blockquote>
<p>其中<code>koa</code>并没有什么特别意思，只是作为一个服务器存在，用<code>express</code>或者其他什么都可以。<br><code>socket.io</code>是我们需要的通讯库</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>1、 前端捕获正在发生的动作<code>action</code>，和触发动作的元素<code>target</code>，通过<code>客户端socket</code>传输到<code>服务器socket</code>;<br>2、 <code>服务器socket</code>接收到信息，再将信息广播到其他所有<code>客户端socket</code>;<br>3、 其他<code>客户端socket</code>接收到广播信息，使特定的元素<code>target</code>触发特定的动作<code>action</code><br><a id="more"></a></p>
<h2 id="服务端准备"><a href="#服务端准备" class="headerlink" title="服务端准备"></a>服务端准备</h2><p>服务器的准备很简单：搭起服务器，接入<code>socket.io</code>。</p>
<p>1、<br>首先利用<code>koa-generator</code>搭起一个<code>koa</code>程序.</p>
<pre><code class="bash">koa -e web-transcribe
cd web-transcribe &amp;&amp; npm install
</code></pre>
<p>2、<br>接入<code>socket.io</code></p>
<pre><code class="bash">npm install --save socket.io
</code></pre>
<p>接着在<code>./bin/</code>下，新建一个js文件<code>io-server.js</code></p>
<pre><code class="js">//io-server.js
var io=require(&#39;socket.io&#39;)();
exports.listen= function (_server) {
    return io.listen(_server);
};
io.on(&#39;connection&#39;, function (_socket) {
    console.log(&#39;connection:\t&#39; + _socket.id );
    //接收客户端信息
    _socket.on(&#39;send&#39;, function (json) {
        //广播到其他客户端
        _socket.broadcast.emit(&#39;get&#39;,json);
    })
});
</code></pre>
<p>在’./bin/www’中加入<code>io-server.js</code>的引用</p>
<pre><code class="js">var app = require(&#39;../app&#39;);
var debug = require(&#39;debug&#39;)(&#39;demo:server&#39;);
var http = require(&#39;http&#39;);
//加下面这一句，接入io-server.js
var io = require(&#39;./io-server&#39;);

var port = normalizePort(process.env.PORT || &#39;3000&#39;);

var server = http.createServer(app.callback());

server.listen(port);
server.on(&#39;error&#39;, onError);
server.on(&#39;listening&#39;, onListening);
//加下面这一句,使socket.io监听在server上
io.listen(server);
//...
</code></pre>
<h2 id="客户端的准备"><a href="#客户端的准备" class="headerlink" title="客户端的准备"></a>客户端的准备</h2><p>客户端的准备要比较多。</p>
<blockquote>
<p>1、 准确捕获发生的动作和目标元素<br>2、 通过<code>socket</code>发送出去<br>3、 接受<code>socket</code>，并使目标元素促发动作。</p>
</blockquote>
<h4 id="1、-准确捕获发生的动作和目标元素"><a href="#1、-准确捕获发生的动作和目标元素" class="headerlink" title="1、 准确捕获发生的动作和目标元素"></a>1、 准确捕获发生的动作和目标元素</h4><p>正在发生的动作相对比较好捕获，因为只是简单的实验，我只做了<code>click</code>动作的捕获。<br>如何确定正在发生动作的元素呢。<br>编写如下代码</p>
<pre><code class="js">//transcribe.js
//确定正在发生动作的元素
function getSelector (element) {
    var tagName = element.tagName.toLowerCase();
    //去空格
    function trim(string) {
        return string &amp;&amp; string.replace(/^\s+|\s+$/g,&quot;&quot;) || string;
    }

    //id绑定的，直接返回。
    if (element.id){
        return &#39;#&#39; + element.id;
    }
    //html
    if (element == document || element == document.documentElement ){
        return &#39;html&#39;;
    }
    //body
    if (element == document.body) {
        return &#39;html&gt;&#39; + tagName;
    }
    //无父级元素，则返回自己
    if (!element.parentNode) {
        return tagName;
    }

    //最后是有父类元素的情况下，确定target是同种兄弟元素的第几个，返回 parentNode &gt; childNode 的精确形式
    var ix = 0,
        siblings = element.parentNode.childNodes,
        elementTagLength = 0,
        className = trim(element.className);

    //统计同种兄弟元素
    for (var i = 0, l = siblings.length; i &lt; l; i++){
        if (className) {
            if(trim(siblings[i].className) === className){
                ++elementTagLength;
            }
        }
        else {
            if ( (siblings[i].nodeType == 1) &amp;&amp; (siblings[i].tagName === element.tagName) ) {
                ++elementTagLength;
            }
        }
    }
    //确定target是父类元素下的第几个兄弟元素
    for (i = 0, l = siblings.length; i &lt; l; i++){
        var sibling = siblings[i];
        if (element === sibling) {
            return arguments.callee(element.parentNode) + &#39;&gt;&#39;
                + ( className
                    ? &#39;.&#39; + className.replace(/\s+/g,&#39;,&#39;)
                    : tagName)
                + ( (!ix &amp;&amp; elementTagLength === 1)
                    ? &#39;&#39;
                    : &#39;:nth-child(&#39; + (ix + 1) + &#39;)&#39;);
        }
        else if (sibling.nodeType == 1) {
            ix++;
        }
    }

};
</code></pre>
<p>最终返回的是<code>id || class || targetName</code></p>
<p>我们需要做一些优化，筛选掉无用的事件，减少<code>socket</code>传输量。<br>在一个html的<code>&lt;head&gt;</code>内写入以下代码，改造<code>addEventListener</code>,为调用过<code>addEventListener</code>的元素加入标识。</p>
<pre><code class="js">&lt;script&gt;
  var __addEventListener = Element.prototype.addEventListener;
  Element.prototype.addEventListener = function (type, handler, capture) {
    if(!this[&#39;events&#39;]){
      this[&#39;events&#39;] = {};
    }
    this[&#39;events&#39;][type] = 1;
    return __addEventListener.apply(this, [type, handler, capture]);
  }
&lt;/script&gt;
</code></pre>
<p>并且编写一个函数做辨识</p>
<pre><code class="js">//transcribe.js
var findHashEventsElements = function (ele, eventType) {
    if (!ele.tagName) return null;
    // 有events标识的 或者 html标签内绑定的 或者 js直接绑定的
    if ( (ele[&#39;events&#39;] &amp;&amp; ele[&#39;events&#39;][eventType]) || ele.hasAttribute(&quot;on&quot; + eventType) || ele[&#39;on&#39; + eventType] ) {
        return ele;
    }
    else {
        if (ele.parentNode != null) {
        //可能有事件委托，追溯上一层
            return findHashEventsElements(ele.parentNode, eventType);
        }
        else {
            return null;
        }
    }
};
</code></pre>
<h4 id="2、-通过socket发送正在发生的动作和目标元素"><a href="#2、-通过socket发送正在发生的动作和目标元素" class="headerlink" title="2、 通过socket发送正在发生的动作和目标元素"></a>2、 通过<code>socket</code>发送正在发生的动作和目标元素</h4><p>正式做<code>click</code>动作的全局时间监听</p>
<pre><code class="js">//transcribe.js
//启动socket连接
var socket = io();
document.addEventListener(&#39;click&#39;, function (e) {
    if (e.button === 0) {
        var target = e.target,
            enable = findHashEventsElements(target, &#39;click&#39;);

        if(enable){
        //发送socket信息哦
            socket.emit(&#39;send&#39;, {
                action: &#39;click&#39;,
                target: getSelector(target),
                time: +new Date()
            })
        }
    }
},true);
</code></pre>
<h4 id="3、-接受socket，并使目标元素促发目标动作。"><a href="#3、-接受socket，并使目标元素促发目标动作。" class="headerlink" title="3、 接受socket，并使目标元素促发目标动作。"></a>3、 接受<code>socket</code>，并使目标元素促发目标动作。</h4><p>新建一个文件<code>trigger.js</code>，写入促发代码</p>
<pre><code class="js">//trigger.js
socket.on(&#39;connect&#39;, function () {
    console.log(&#39;connect&#39;);
    socket.on(&#39;get&#39;, function (data) {
        console.log(&quot;trigger\t&quot;+data.target+&quot;\t&quot;+data.action);
        document.querySelector(data.target).dispatchEvent(new Event(data.action));
    })
});
</code></pre>
<p>之前这里，我使用了<code>JQuery</code>的<code>trigger</code>:</p>
<pre><code class="js">$(data.target).trigger(data.action)
</code></pre>
<p>但是这样会造成页面间的重复触发。<br>就比如<br><code>a.html</code>触发了 click;<br><code>b.html</code>页面收到指令，也触发 click，结果这个click又重新发送socket到<code>b.html</code>;<br><code>b.html</code>收到指令，又触发click，结果这个click又重新发送socket到<code>a.html</code>;<br>这样反复，永不停歇。<br>看来<code>JQuery</code>的<code>trigger</code>是直接操作元素触发的，于是改用原生的<code>dispatchEvent</code>。完成</p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>合并源代码到<code>io.js</code>.<br>编写简单的html，完成一个demo</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;script&gt;
      var __addEventListener = Element.prototype.addEventListener;
      Element.prototype.addEventListener = function (type, handler, capture) {
        if(!this[&#39;events&#39;]){
          this[&#39;events&#39;] = {};
        }
        this[&#39;events&#39;][type] = 1;
        return __addEventListener.apply(this, [type, handler, capture]);
      }
    &lt;/script&gt;
    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;
    &lt;link rel=&#39;stylesheet&#39; href=&#39;/stylesheets/style.css&#39; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;
    &lt;p&gt;Welcome to &lt;%= title %&gt;&lt;/p&gt;
    &lt;button id=&quot;btn1&quot;&gt;blue&lt;/button&gt;
    &lt;button onClick=&quot;body_color(&#39;red&#39;)&quot;&gt;red&lt;/button&gt;
    &lt;button class=&quot;reset_btn&quot;&gt;reset&lt;/button&gt;
    &lt;script&gt;
      document.getElementById(&#39;btn1&#39;).addEventListener(&#39;click&#39;, function () {
        body_color(&#39;blue&#39;)
      })
      document.querySelector(&quot;.reset_btn&quot;).onclick= function () {
        body_color(&#39;none&#39;);
      }
      function body_color(color) {
          document.body.style[&#39;background&#39;] = color;
      }
    &lt;/script&gt;
    &lt;script src=&quot;/javascripts/io.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><a href="https://github.com/zjy01/web-transcribe" target="_blank" rel="noopener">源代码</a></p>
<p>看效果图哟<br><img src="http://p1.bpimg.com/567571/ee184984bded2120.gif" alt=""></p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>现在只是最简单的<code>click</code>传输。<br>之后完善代码，就可以捕获其他动作。<br>完善服务器，做成代码植入的形式。<br>玩起来还是乐趣无穷的。</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = '/2016/10/10/koa-socket-io尝试简单的web动作同步/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2016/10/10/koa-socket-io尝试简单的web动作同步/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>
<script type="text/ls-javascript" id="disqus-thread-script">
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//carvenzhang.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/11/08/cors/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/09/02/好用的分屏tab-react-native-scrollable-tab-view/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/public/img/avatar.png" alt="carvenzhang's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        525315462@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">十月 2015<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/javascript/">javascript<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/categories/mac/">mac<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/nodejs/">nodejs<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/前端/">前端<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/博客/">博客<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/后端/">后端<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/实习/">实习<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/每周积累计划/">每周积累计划<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">33</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/2415799587" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/zjy01" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2015&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>zjyBlog
            
                <br>
                
                    From GDUFS QuantaCenter
                
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- 使用 DISQUS js 代码 -->
<script id="dsq-count-scr" src="//carvenzhang.disqus.com/count.js" async></script>





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
